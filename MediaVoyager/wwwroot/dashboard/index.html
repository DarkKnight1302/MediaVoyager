<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediaVoyager Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
         margin: 0;
  padding: 0;
    box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        min-height: 100vh;
     color: #fff;
    }

        .header {
    background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
         padding: 20px 40px;
            display: flex;
justify-content: space-between;
     align-items: center;
          border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

    .header h1 {
    font-size: 28px;
   background: linear-gradient(90deg, #e94560, #ff6b6b);
       -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
            background-clip: text;
     display: flex;
 align-items: center;
     gap: 12px;
        }

        .header h1 .icon {
    width: 36px;
            height: 36px;
   background: linear-gradient(135deg, #e94560, #ff6b6b);
            border-radius: 8px;
            display: flex;
         align-items: center;
            justify-content: center;
        }

        .header h1 .icon svg {
            width: 22px;
    height: 22px;
    fill: white;
   }

        .header-controls {
          display: flex;
            gap: 15px;
         align-items: center;
  }

   .days-selector {
       padding: 10px 20px;
            border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.2);
  background: rgba(255, 255, 255, 0.1);
            color: #fff;
    font-size: 14px;
            cursor: pointer;
        }

        .days-selector option {
  background: #1a1a2e;
   color: #fff;
    }

        .refresh-btn {
          padding: 10px 25px;
     border-radius: 8px;
    border: none;
            background: linear-gradient(90deg, #e94560, #ff6b6b);
            color: #fff;
   font-size: 14px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
    display: flex;
       align-items: center;
     gap: 8px;
        }

        .refresh-btn svg {
            width: 16px;
  height: 16px;
     fill: white;
      }

        .refresh-btn:hover {
            transform: translateY(-2px);
    box-shadow: 0 5px 20px rgba(233, 69, 96, 0.4);
        }

        .container {
       padding: 30px 40px;
        }

        .stats-grid {
 display: grid;
     grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
     gap: 20px;
     margin-bottom: 30px;
        }

 .stat-card {
        background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 25px;
         border: 1px solid rgba(255, 255, 255, 0.1);
     transition: transform 0.3s, box-shadow 0.3s;
        }

        .stat-card:hover {
    transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .stat-card .icon {
            width: 50px;
    height: 50px;
            border-radius: 12px;
     display: flex;
align-items: center;
         justify-content: center;
     margin-bottom: 15px;
        }

        .stat-card .icon svg {
      width: 26px;
          height: 26px;
            fill: white;
  }

        .stat-card.users .icon { background: linear-gradient(135deg, #667eea, #764ba2); }
        .stat-card.dau .icon { background: linear-gradient(135deg, #11998e, #38ef7d); }
        .stat-card.mau .icon { background: linear-gradient(135deg, #fc4a1a, #f7b733); }
   .stat-card.movies .icon { background: linear-gradient(135deg, #e94560, #ff6b6b); }
  .stat-card.tv .icon { background: linear-gradient(135deg, #00b4db, #0083b0); }
    .stat-card.search .icon { background: linear-gradient(135deg, #8e2de2, #4a00e0); }
        .stat-card.watchlist .icon { background: linear-gradient(135deg, #f093fb, #f5576c); }

        .stat-card h3 {
      font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
 margin-bottom: 8px;
     text-transform: uppercase;
       letter-spacing: 1px;
      }

        .stat-card .value {
     font-size: 36px;
            font-weight: bold;
       background: linear-gradient(90deg, #fff, #e0e0e0);
          -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .charts-grid {
     display: grid;
   grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
        gap: 25px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
    border-radius: 16px;
            padding: 25px;
   border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chart-card h2 {
            font-size: 18px;
            margin-bottom: 20px;
       color: #fff;
            display: flex;
  align-items: center;
         gap: 10px;
  }

        .chart-card h2::before {
  content: '';
     width: 4px;
            height: 20px;
 background: linear-gradient(180deg, #e94560, #ff6b6b);
            border-radius: 2px;
        }

 .chart-container {
            position: relative;
         height: 300px;
        }

   .loading {
            display: flex;
          align-items: center;
            justify-content: center;
            height: 200px;
       color: rgba(255, 255, 255, 0.5);
   }

        .loading::after {
 content: '';
   width: 30px;
          height: 30px;
       border: 3px solid rgba(255, 255, 255, 0.1);
   border-top-color: #e94560;
            border-radius: 50%;
    animation: spin 1s linear infinite;
            margin-left: 10px;
        }

      @keyframes spin {
            to { transform: rotate(360deg); }
        }

      .error-message {
         background: rgba(233, 69, 96, 0.2);
       border: 1px solid #e94560;
      border-radius: 8px;
        padding: 15px 20px;
  margin-bottom: 20px;
          display: none;
        }

        .last-updated {
        text-align: center;
  color: rgba(255, 255, 255, 0.5);
            font-size: 12px;
            margin-top: 20px;
    }

        @media (max-width: 768px) {
    .header {
    flex-direction: column;
         gap: 15px;
                padding: 15px 20px;
            }

    .container {
            padding: 20px;
        }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .stat-card .value {
             font-size: 28px;
      }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>
          <span class="icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
 </svg>
            </span>
    MediaVoyager Analytics Dashboard
        </h1>
    <div class="header-controls">
<select class="days-selector" id="daysSelector">
           <option value="7">Last 7 Days</option>
    <option value="14">Last 14 Days</option>
    <option value="30" selected>Last 30 Days</option>
        <option value="60">Last 60 Days</option>
   <option value="90">Last 90 Days</option>
     </select>
   <button class="refresh-btn" onclick="loadDashboard()">
   <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
           <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
              </svg>
                Refresh
   </button>
     </div>
    </div>

    <div class="container">
        <div class="error-message" id="errorMessage"></div>

   <!-- Stats Cards -->
     <div class="stats-grid">
    <div class="stat-card users">
              <div class="icon">
                 <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
      <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
        </svg>
     </div>
        <h3>Total Users</h3>
    <div class="value" id="totalUsers">-</div>
       </div>
       <div class="stat-card dau">
       <div class="icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/>
        </svg>
           </div>
      <h3>Daily Active Users</h3>
                <div class="value" id="dailyActiveUsers">-</div>
            </div>
            <div class="stat-card mau">
              <div class="icon">
     <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
      <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
  </svg>
           </div>
   <h3>Monthly Active Users</h3>
     <div class="value" id="monthlyActiveUsers">-</div>
  </div>
            <div class="stat-card movies">
              <div class="icon">
   <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
  <path d="M18 4l2 4h-3l-2-4h-2l2 4h-3l-2-4H8l2 4H7L5 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4h-4z"/>
    </svg>
                </div>
       <h3>Movie Recommendations</h3>
      <div class="value" id="movieRecommendations">-</div>
            </div>
          <div class="stat-card tv">
   <div class="icon">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M21 3H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h5v2h8v-2h5c1.1 0 1.99-.9 1.99-2L23 5c0-1.1-.9-2-2-2zm0 14H3V5h18v12z"/>
 </svg>
    </div>
      <h3>TV Show Recommendations</h3>
         <div class="value" id="tvRecommendations">-</div>
  </div>
         <div class="stat-card search">
   <div class="icon">
           <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
               <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
             </svg>
           </div>
  <h3>Total Searches</h3>
        <div class="value" id="totalSearches">-</div>
      </div>
            <div class="stat-card watchlist">
    <div class="icon">
   <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
           </svg>
  </div>
                <h3>Watchlist Additions</h3>
              <div class="value" id="watchlistAdditions">-</div>
      </div>
        </div>

        <!-- Charts -->
   <div class="charts-grid">
   <div class="chart-card">
                <h2>User Signups Over Time</h2>
        <div class="chart-container">
        <canvas id="signupsChart"></canvas>
        </div>
       </div>
   <div class="chart-card">
           <h2>Daily Active Users</h2>
          <div class="chart-container">
          <canvas id="dauChart"></canvas>
         </div>
  </div>
            <div class="chart-card">
      <h2>Movie vs TV Recommendations</h2>
          <div class="chart-container">
      <canvas id="recommendationsChart"></canvas>
       </div>
            </div>
            <div class="chart-card">
<h2>Search Activity</h2>
      <div class="chart-container">
       <canvas id="searchChart"></canvas>
       </div>
  </div>
         <div class="chart-card">
                <h2>Watchlist Activity</h2>
 <div class="chart-container">
           <canvas id="watchlistChart"></canvas>
         </div>
         </div>
        <div class="chart-card">
             <h2>Users Who Searched (Daily)</h2>
    <div class="chart-container">
        <canvas id="searchUsersChart"></canvas>
      </div>
          </div>
     </div>

        <div class="last-updated" id="lastUpdated"></div>
    </div>

    <script>
        // Chart instances
        let charts = {};

    // Chart.js default configuration
        Chart.defaults.color = 'rgba(255, 255, 255, 0.7)';
        Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.1)';

        const chartOptions = {
   responsive: true,
            maintainAspectRatio: false,
            plugins: {
   legend: {
         labels: {
    color: 'rgba(255, 255, 255, 0.8)',
      font: { size: 12 }
 }
                }
       },
 scales: {
 x: {
        grid: { color: 'rgba(255, 255, 255, 0.05)' },
     ticks: { color: 'rgba(255, 255, 255, 0.6)' }
   },
            y: {
             grid: { color: 'rgba(255, 255, 255, 0.05)' },
      ticks: { color: 'rgba(255, 255, 255, 0.6)' },
              beginAtZero: true
          }
        }
        };

        function formatDate(dateString) {
          const date = new Date(dateString);
 return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

     function showError(message) {
            const errorEl = document.getElementById('errorMessage');
  errorEl.textContent = message;
          errorEl.style.display = 'block';
            setTimeout(() => { errorEl.style.display = 'none'; }, 5000);
        }

        function destroyCharts() {
            Object.values(charts).forEach(chart => {
    if (chart) chart.destroy();
   });
 charts = {};
     }

        function createGradient(ctx, color1, color2) {
            const gradient = ctx.createLinearGradient(0, 0, 0, 300);
  gradient.addColorStop(0, color1);
       gradient.addColorStop(1, color2);
   return gradient;
        }

    async function loadDashboard() {
            const days = document.getElementById('daysSelector').value;

      try {
    const response = await fetch(`/api/dashboard?days=${days}`);
       if (!response.ok) {
    throw new Error('Failed to fetch dashboard data');
                }

          const data = await response.json();
   updateDashboard(data);
      document.getElementById('lastUpdated').textContent =
        `Last updated: ${new Date().toLocaleString()}`;

            } catch (error) {
     console.error('Error loading dashboard:', error);
       showError('Failed to load dashboard data. Please try again.');
         }
 }

        function updateDashboard(data) {
     // Update stat cards
      document.getElementById('totalUsers').textContent =
          (data.user_signups?.total_users || 0).toLocaleString();
     document.getElementById('dailyActiveUsers').textContent =
                (data.active_users?.daily_active_users || 0).toLocaleString();
    document.getElementById('monthlyActiveUsers').textContent =
           (data.active_users?.monthly_active_users || 0).toLocaleString();
            document.getElementById('movieRecommendations').textContent =
        (data.recommendations?.total_movie_recommendations || 0).toLocaleString();
            document.getElementById('tvRecommendations').textContent =
   (data.recommendations?.total_tv_recommendations || 0).toLocaleString();

       const totalSearches = (data.searches?.total_movie_searches || 0) +
   (data.searches?.total_tv_searches || 0);
       document.getElementById('totalSearches').textContent = totalSearches.toLocaleString();

            const watchlistTotal = (data.watchlist?.total_movies_added_to_watchlist || 0) +
          (data.watchlist?.total_tv_added_to_watchlist || 0);
      document.getElementById('watchlistAdditions').textContent = watchlistTotal.toLocaleString();

        // Destroy existing charts
  destroyCharts();

            // Create charts
       createSignupsChart(data.user_signups?.signups_by_date || []);
            createDAUChart(data.active_users?.daily_active_users_by_date || []);
          createRecommendationsChart(
  data.recommendations?.movie_recommendations_by_date || [],
      data.recommendations?.tv_recommendations_by_date || []
      );
      createSearchChart(
         data.searches?.movie_searches_by_date || [],
         data.searches?.tv_searches_by_date || []
     );
   createWatchlistChart(data.watchlist?.watchlist_activity_by_date || []);
  createSearchUsersChart(data.searches?.unique_users_by_date || []);
        }

        function createSignupsChart(signupsData) {
            const ctx = document.getElementById('signupsChart').getContext('2d');
  const gradient = createGradient(ctx, 'rgba(102, 126, 234, 0.8)', 'rgba(118, 75, 162, 0.2)');

            charts.signups = new Chart(ctx, {
     type: 'line',
     data: {
         labels: signupsData.map(d => formatDate(d.date)),
          datasets: [{
     label: 'New Users',
     data: signupsData.map(d => d.count),
  borderColor: '#667eea',
   backgroundColor: gradient,
            fill: true,
         tension: 0.4,
       pointRadius: 4,
     pointBackgroundColor: '#667eea'
     }]
     },
                options: chartOptions
       });
        }

     function createDAUChart(dauData) {
            const ctx = document.getElementById('dauChart').getContext('2d');
            const gradient = createGradient(ctx, 'rgba(17, 153, 142, 0.8)', 'rgba(56, 239, 125, 0.2)');

            charts.dau = new Chart(ctx, {
                type: 'bar',
          data: {
            labels: dauData.map(d => formatDate(d.date)),
   datasets: [{
        label: 'Active Users',
              data: dauData.map(d => d.count),
                backgroundColor: gradient,
       borderColor: '#11998e',
    borderWidth: 1,
           borderRadius: 4
       }]
       },
          options: chartOptions
   });
     }

        function createRecommendationsChart(movieData, tvData) {
  const ctx = document.getElementById('recommendationsChart').getContext('2d');

            // Merge dates from both datasets
            const allDates = [...new Set([
          ...movieData.map(d => d.date),
            ...tvData.map(d => d.date)
   ])].sort();

     const movieCounts = allDates.map(date => {
    const item = movieData.find(d => d.date === date);
        return item ? item.count : 0;
            });

   const tvCounts = allDates.map(date => {
    const item = tvData.find(d => d.date === date);
     return item ? item.count : 0;
       });

            charts.recommendations = new Chart(ctx, {
      type: 'line',
data: {
         labels: allDates.map(d => formatDate(d)),
  datasets: [
  {
   label: 'Movie Recommendations',
    data: movieCounts,
borderColor: '#e94560',
         backgroundColor: 'rgba(233, 69, 96, 0.1)',
                fill: true,
         tension: 0.4
           },
       {
            label: 'TV Recommendations',
     data: tvCounts,
             borderColor: '#00b4db',
          backgroundColor: 'rgba(0, 180, 219, 0.1)',
       fill: true,
      tension: 0.4
  }
          ]
     },
        options: chartOptions
      });
 }

        function createSearchChart(movieSearches, tvSearches) {
            const ctx = document.getElementById('searchChart').getContext('2d');

            const allDates = [...new Set([
     ...movieSearches.map(d => d.date),
             ...tvSearches.map(d => d.date)
         ])].sort();

    const movieCounts = allDates.map(date => {
          const item = movieSearches.find(d => d.date === date);
        return item ? item.count : 0;
        });

        const tvCounts = allDates.map(date => {
     const item = tvSearches.find(d => d.date === date);
                return item ? item.count : 0;
          });

         charts.search = new Chart(ctx, {
       type: 'bar',
  data: {
   labels: allDates.map(d => formatDate(d)),
datasets: [
        {
    label: 'Movie Searches',
             data: movieCounts,
       backgroundColor: 'rgba(142, 45, 226, 0.7)',
     borderColor: '#8e2de2',
  borderWidth: 1,
    borderRadius: 4
      },
 {
                 label: 'TV Searches',
               data: tvCounts,
       backgroundColor: 'rgba(74, 0, 224, 0.7)',
            borderColor: '#4a00e0',
        borderWidth: 1,
  borderRadius: 4
       }
       ]
 },
                options: chartOptions
     });
        }

        function createWatchlistChart(watchlistData) {
            const ctx = document.getElementById('watchlistChart').getContext('2d');
            const gradient = createGradient(ctx, 'rgba(240, 147, 251, 0.8)', 'rgba(245, 87, 108, 0.2)');

            charts.watchlist = new Chart(ctx, {
     type: 'line',
   data: {
           labels: watchlistData.map(d => formatDate(d.date)),
      datasets: [{
          label: 'Watchlist Additions',
       data: watchlistData.map(d => d.count),
 borderColor: '#f093fb',
         backgroundColor: gradient,
  fill: true,
         tension: 0.4,
    pointRadius: 4,
    pointBackgroundColor: '#f093fb'
     }]
         },
       options: chartOptions
  });
      }

        function createSearchUsersChart(userData) {
        const ctx = document.getElementById('searchUsersChart').getContext('2d');
            const gradient = createGradient(ctx, 'rgba(252, 74, 26, 0.8)', 'rgba(247, 183, 51, 0.2)');

          charts.searchUsers = new Chart(ctx, {
      type: 'bar',
           data: {
       labels: userData.map(d => formatDate(d.date)),
     datasets: [{
          label: 'Unique Users',
  data: userData.map(d => d.count),
      backgroundColor: gradient,
  borderColor: '#fc4a1a',
        borderWidth: 1,
  borderRadius: 4
    }]
          },
    options: chartOptions
         });
        }

 // Auto-refresh every 5 minutes
    setInterval(loadDashboard, 5 * 60 * 1000);

// Initial load
        document.addEventListener('DOMContentLoaded', loadDashboard);

     // Reload on days change
        document.getElementById('daysSelector').addEventListener('change', loadDashboard);
    </script>
</body>
</html>
